/*
 AngularLovefield v1.0.0
 (c) 2016 ionutpetre.ro@gmail.com
 License: MIT
*/
!function(){angular.module("ngLovefield",[]).constant("LV_CONSTS",{MSG_PREFIX:"[ngLovefield]: ",TYPES:["ARRAY_BUFFER","BOOLEAN","DATE_TIME","INTEGER","NUMBER","STRING","OBJECT"],NAMING_PATTERN:/^[A-Za-z_][A-Za-z0-9_]*$/}).provider("$lovefield",["LV_CONSTS",function(a){function e(b){return a.NAMING_PATTERN.test(b)}function f(a){return/^-?[0-9]+$/.test(a)}function g(b){return angular.isNumber(b)?f(b)?b<=0?a.MSG_PREFIX+"db version must be an integer greater than 0":null:a.MSG_PREFIX+"db version must be an integer number":a.MSG_PREFIX+"db version must be a number"}function h(b){return angular.isString(b)?e(b)?null:a.MSG_PREFIX+"db name must abide lf's naming rule":a.MSG_PREFIX+"db name must be a string"}function k(b){if(!angular.isArray(b))return a.MSG_PREFIX+"db tables must be an array of objects"}var b=null,c=null,d=null;this.setDbName=function(a){var c=h(a);c?console.error(c):b=a},this.setDbVersion=function(a){var b=g(a);b?console.error(b):c=a},this.setDbTables=function(a){var b=k(a);b?console.error(b):d=a},this.addDbTable=function(a){d=d?d:[];var b=k(dbTables);b?console.error(b):d.push(a)},this.$get=["$q",function(e){function f(){function h(){b&&c?(f=lf.schema.create(b,c),console.info(a.MSG_PREFIX+"db schema "+b+" version "+c+" created successfully")):console.error(a.MSG_PREFIX+"db name or db version were not specified")}function i(){f&&d?d.forEach(function(b){var c=f.createTable(b.name);b.columns.forEach(function(a){c.addColumn(a.name,lf.Type[a.type])}),c.addPrimaryKey([b.primaryKey]),console.info(a.MSG_PREFIX+"db table "+b.name+" created successfully")}):console.error(a.MSG_PREFIX+"db schema or db tables were not created")}function j(){var a=e.defer();return null==g?(null==f&&(h(),i()),f.connect().then(function(b){g=b,a.resolve(g)})):a.resolve(g),a.promise}var f=null,g=null;this.insertItem=function(b,c){var d=e.defer();if(b&&c)j().then(function(e){var f=e.getSchema().table(b),g=f.createRow(c);e.insertOrReplace().into(f).values([g]).exec().then(function(c){var e=a.MSG_PREFIX+"item inserted successfully into "+b;console.info(e),d.resolve(c)})});else{var f=a.MSG_PREFIX+"table name or item were not specified";console.error(f),d.reject(f)}return d.promise},this.getAllItems=function(b){var c=e.defer();if(b)j().then(function(d){var e=d.getSchema().table(b);d.select().from(e).exec().then(function(d){var e=a.MSG_PREFIX+"successfully get all items from "+b;console.info(e),c.resolve(d)})});else{var d=a.MSG_PREFIX+"table name was not specified";console.error(d),c.reject(d)}return c.promise}}return new f}]}])}();